<% layout("/layouts/boilerplate") %>

  <style>
    #filters {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      overflow-x: auto;
      width: 100%;
      padding: 1rem 0;
      -webkit-overflow-scrolling: touch;
      /* smooth scrolling on iOS */
      scrollbar-width: none;
      /* Firefox */
    }

    #filters::-webkit-scrollbar {
      display: none;
      /* Chrome, Safari, Opera */
    }

    .filter {
      text-align: center;
      margin-right: 2rem;
      opacity: 0.7;
      color: black;
      flex-shrink: 0;
      /* Prevent shrinking */
      min-width: 60px;
      /* Ensure clickable area */
    }

    .filter:hover {
      opacity: 1;
      cursor: pointer;
    }

    .filter p {
      font-size: 0.8rem;
      margin-top: 0.5rem;
      /* Add some spacing between icon and text */
      margin-bottom: 0;
    }

    .tax-info {
      display: none;
    }

    .tag-toggle {
      border: 1px solid #ddd;
      border-radius: 1rem;
      height: 3.25rem;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      margin-left: auto;
      /* Push to right on desktop */
      flex-shrink: 0;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      #filters {
        padding-bottom: 0.5rem;
      }

      .tag-toggle {
        display: none;
        /* Optionally hide or move on very small screens if it takes too much space, or we can create a separate row */
      }

      /* If we want to keep the toggle on mobile, we might place it above or below filters, but standard Airbnb hides filters or puts them in a modal on mobile mostly, but scrolling is fine. 
       Let's keep the toggle but maybe make it smaller or separate row if requested. For now, hiding on very small screens or moving it is safer to prevent overlap. 
       Actually, let's keep it visible but maybe outside the scroll container?
       The current structure has it IN the #filters container. If #filters is scrolling, the toggle will scroll away. 
       Let's move the toggle OUT of #filters for better layout control.
    */
    }
  </style>

  <div class="filters-container d-flex align-items-center mb-3">
    <div id="filters">
      <a href="/listings"
        class="filter <%= selectedCategory === undefined || selectedCategory === '' ? 'active' : '' %>">
        <div><i class="fa-solid fa-fire"></i></div>
        <p>Trending</p>
      </a>
      <a href="/listings?category=Iconic Cities"
        class="filter <%= selectedCategory === 'Iconic Cities' ? 'active' : '' %>">
        <div><i class="fa-solid fa-mountain-city"></i></div>
        <p>Iconic Cities </p>
      </a>
      <a href="/listings?category=Mountains" class="filter <%= selectedCategory === 'Mountains' ? 'active' : '' %>">
        <div><i class="fa-solid fa-mountain"></i></div>
        <p>Mountains</p>
      </a>
      <a href="/listings?category=Amazing pools"
        class="filter <%= selectedCategory === 'Amazing pools' ? 'active' : '' %>">
        <div><i class="fa-solid fa-person-swimming"></i></div>
        <p>Amazing pools</p>
      </a>
      <a href="/listings?category=Castles" class="filter <%= selectedCategory === 'Castles' ? 'active' : '' %>">
        <div><i class="fa-solid fa-bed"></i></div>
        <p>Castles</p>
      </a>
      <a href="/listings?category=Camping" class="filter <%= selectedCategory === 'Camping' ? 'active' : '' %>">
        <div><i class="fa-solid fa-campground"></i></div>
        <p>Camping</p>
      </a>
      <a href="/listings?category=Farms" class="filter <%= selectedCategory === 'Farms' ? 'active' : '' %>">
        <div><i class="fa-solid fa-cow"></i></div>
        <p>Farms</p>
      </a>
      <a href="/listings?category=Arctic" class="filter <%= selectedCategory === 'Arctic' ? 'active' : '' %>">
        <div><i class="fa-solid fa-person-swimming"></i></div>
        <p>Arctic </p>
      </a>
      <a href="/listings?category=Domes" class="filter <%= selectedCategory === 'Domes' ? 'active' : '' %>">
        <div><i class="fa-solid fa-igloo"></i></div>
        <p>Domes </p>
      </a>
      <a href="/listings?category=Boats" class="filter <%= selectedCategory === 'Boats' ? 'active' : '' %>">
        <div><i class="fa-regular fa-snowflake"></i></div>
        <p>Boats </p>
      </a>
    </div>

    <!-- Toggle outside the scrollable area -->
    <div class="tag-toggle ms-auto d-none d-md-flex">
      <div class="form-check-reverse form-switch">
        <input type="checkbox" class="form-check-input" role="switch" id="flexSwitchCheckDefault">
        <label class="form-check-label" for="flexSwitchCheckDefault">Display total after taxes</label>
      </div>
    </div>
  </div>

  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
    <% if(allListings.length===0) { %>
      <div class="col-12">
        <p style="text-align: center; padding: 2rem; font-size: 1.1rem; color: #666;">
          No listings found for <strong>
            <%= selectedCategory || 'this category' %>
          </strong>. Try selecting a different filter!
        </p>
      </div>
      <% } %>
        <% for(let listing of allListings) { %>
          <a href="/listings/<%= listing._id %>" class="listing-links">
            <div class="card col listing-card">
              <img src="<%= typeof listing.image === 'object' ? listing.image.url : listing.image %>"
                class="card-img-top" alt="listing_image" style="height: 20rem" />
              <div class="card-img-overlay"></div>
              <div class="card-body">
                <p class="card-text">
                  <b>
                    <%= listing.title %><br>
                  </b>
                  &#8377; <%= listing.price.toLocaleString("en-IN") %> /night
                    <i class="tax-info">&nbsp; &nbsp; +18% GST</i>
                </p>
              </div>
            </div>
          </a>
          <% } %>
  </div>

  <script>
    let taxSwitch = document.getElementById('flexSwitchCheckDefault');
    if (taxSwitch) {
      taxSwitch.addEventListener("click", () => {
        let taxInfo = document.querySelectorAll('.tax-info');
        for (info of taxInfo) {
          if (info.style.display != "inline") {
            info.style.display = "inline";
          } else {
            info.style.display = "none";
          }
        }
      });
    }
  </script>